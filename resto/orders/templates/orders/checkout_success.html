{% extends "base.html" %}

{% block title %}Commande confirm√©e{% endblock %}

{% block content %}
<div class="d-flex justify-content-center mt-5">
  <div class="card shadow-lg border-0" style="max-width: 520px;">
    <div class="card-body text-center p-4">

      <div class="mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="#28a745" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM6.97 10.03l4.242-4.243-1.06-1.06L6.97 7.91 5.383 6.324l-1.06 1.06L6.97 10.03z"/>
        </svg>
      </div>

      <h1 class="h4 mb-2">Merci pour votre commande</h1>

      <p class="text-muted mb-3">
        Votre commande <strong>#{{ order.id }}</strong> a √©t√© enregistr√©e avec succ√®s.
      </p>
      <!-- D√©tails de la commande -->
      <div class="text-start mx-auto mt-3" style="max-width: 420px;">
        <div class="fw-bold mb-2">D√©tails</div>

        {% for it in order.items.all %}
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div class="me-3">
              <div class="fw-semibold">{{ it.meal.name }}</div>
              <div class="text-muted small">
                Variante: {{ it.variant_code }} ‚Ä¢ Qt√©: {{ it.quantity }}
              </div>
            </div>
            <div class="fw-semibold">{{ it.subtotal }} FCFA</div>
          </div>
        {% empty %}
          <div class="text-muted">Aucun item.</div>
        {% endfor %}
      </div>

      <!-- R√©cap r√©el (source de v√©rit√© = Order) -->
      <div class="text-start mx-auto" style="max-width: 420px;">
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Sous-total</span>
          <span class="fw-semibold">{{ order.subtotal }} FCFA</span>
        </div>

        {% if order.discount_total and order.discount_total > 0 %}
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">
              Remise
              {% if order.promo_code %}({{ order.promo_code }}){% endif %}
            </span>
            <span class="fw-semibold">- {{ order.discount_total }} FCFA</span>
          </div>
        {% endif %}

        <hr class="my-3">

        <div class="d-flex justify-content-between align-items-center">
          <span class="fw-bold fs-6">Total</span>
          <span class="fw-bold fs-5">{{ order.total }} FCFA</span>
        </div>

        {% if used_voucher %}
          <div class="alert alert-success py-2 mt-3 mb-0">
            üéÅ Bon plat gratuit appliqu√©.
          </div>
        {% endif %}
      </div>

      <a href="{% url 'shop:meal_list' %}" class="btn btn-primary btn-lg w-100 mt-4">
        Retour au menu
      </a>

      <p class="text-muted small mt-3 mb-0">
        Vous recevrez votre repas sous peu. Merci pour votre confiance.
      </p>
    </div>
  </div>
</div>
{% endblock %}
